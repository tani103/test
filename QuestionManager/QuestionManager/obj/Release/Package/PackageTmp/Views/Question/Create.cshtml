@model QuestionManager.Models.questions

<!DOCTYPE html>

<script src="~/Scripts/MicrosoftAjax.js" type="text/javascript"></script>
<script src="~/Scripts/MicrosoftMvcAjax.js" type="text/javascript"></script>
<script src="~/Scripts/MicrosoftMvcValidation.js" type="text/javascript"></script>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>問題追加</title>
</head>
<body>
    <div class="page">
        <div id="main">
            <h2>問題追加</h2>
            @using (Html.BeginForm("Create", "Question", FormMethod.Post, new { @name = "questionEntryForm", onSubmit = "return check()", enctype = "multipart/form-data" }))
            {
                @*偽装防止トークン*@
                @Html.AntiForgeryToken()
                <fieldset>
                    <div class="editor-label">
                        カテゴリ名
                    </div>
                    <div class="editor-field">
                        @Html.DropDownList("CategoryName", null, "カテゴリを選択して下さい。", new { id = "CategoryName" })
                    </div>
                    <div class="editor-label">
                        課題名
                    </div>
                    <div class="editor-field">
                        <select class="form-control" id="SubjectID" name="SubjectID">
                            @{
                                int i = 0;
                                foreach (var p in ViewBag.SubjectID)
                                {
                                    if (i == 0)
                                    {
                                        <option value="0">教科名を選択して下さい。</option>
                                        i++;
                                    }
                                    <option value="@p.SubjectID" class="@string.Format("p{0}",p.CategoryID)"> @p.SubjectName</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="editor-label">
                        問題
                    </div>
                    <div class="editor-field">
                        @Html.TextBoxFor(model => model.question)
                        @Html.ValidationMessageFor(model => model.question, "*")
                    </div>
                    <div class="editor-label">
                        <br />問題に添付する画像：
                    </div>
                    <div class="editor-field">
                        <input type="file" name="fl" size="50" />
                    </div>
                    <div class="editor-label">
                        正解
                    </div>
                    <div class="editor-field">
                        @Html.TextBoxFor(model => model.Answer)
                        @Html.ValidationMessageFor(model => model.Answer, "*")
                    </div>
                    <p>
                        <input type="submit" value="追加" />
                    </p>
                </fieldset>
            }
            <div>
                @Html.ActionLink("戻る", "Index")
            </div>
            <script src="~/Scripts/MicrosoftAjax.js" type="text/javascript"></script>
            <script src="~/Scripts/MicrosoftMvcAjax.js" type="text/javascript"></script>
            <script src="~/Scripts/jquery-1.9.1.min.js" type="text/javascript"></script>
            <script src="~/Scripts/MicrosoftMvcValidation.js" type="text/javascript"></script>

            <script type="text/javascript">
                $(function () {
                    // カテゴリ名
                    var SubjectNam = $("#SubjectID");

                    // 教科名のoption内容をコピー
                    var pd2 = $("#SubjectID option").clone();

                    // カテゴリドロップダウンリストが変更されたら作動
                    $("#CategoryName").change(function () {

                        // 教科名をeabled
                        SubjectNam.removeAttr('disabled');

                        // カテゴリ名のval取得
                        var lv1val = $("#CategoryName").val();

                        // 一旦、カテゴリ名のoption削除
                        $("#SubjectID option").remove();

                        // (コピーしてきた)コピー元のカテゴリを表示
                        $(pd2).appendTo("#SubjectID");

                        // 選択値以外のclassのoption削除
                        $("#SubjectID option[class != p" + lv1val + "]").remove();

                        // 「教科名を選択してください。」optionを先頭に表示
                        $("#SubjectID").prepend('<option value="0" selected="selected">教科名を選択して下さい。</option>');

                        // カテゴリドロップダウンリストを2回目以降操作時、カテゴリ名が未選択なら教科をdisabledにする
                        if ($("#CategoryName").val() == "") {
                            SubjectNam.attr('disabled', 'disabled');
                        }
                    });
                    // カテゴリ名が未選択なら教科をdisabledにする
                    if ($("#CategoryName").val() == "" || $("#SubjectID").val() == "") {
                        SubjectNam.attr('disabled', 'disabled');
                    }
                });
            </script>
            <script type="text/javascript">
<!--
                function check() {
                    var flag = false;

                    if (document.questionEntryForm.SubjectID.options[document.questionEntryForm.SubjectID.selectedIndex].value == "0") {
                        flag = true;
                    }

                    if (flag) {
                        window.alert('教科名が選択されていません');
                        // 送信を中止
                        return false;
                    }
                    else {
                        // 送信を実行
                        return true;
                    }
                }
            </script>
            <div id="footer">
            </div>
        </div>
    </div>
</body>
</html>
